<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrowSEA - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .tab-active {
            background-color: #00b8ff !important;
            color: white !important;
        }
        .tab-inactive {
            background-color: #1e3a5f !important;
            color: #87b8cc !important;
        }
        .form-hidden {
            display: none !important;
        }
    </style>
</head>

<body class="flex flex-col items-center justify-center h-screen bg-transparent" data-is-register="false">
    <div class="fixed inset-0 flex justify-center items-start pt-8">
        <!-- Main Modal Box -->
        <div id="mainModal" class="relative bg-[#2b4d6d] border-4 border-[#87b8cc] shadow-lg p-8 w-3/5 max-w-lg sm:w-4/5 xs:w-11/12 h-auto rounded-lg flex flex-col justify-center transition-all duration-700 ease-out">
            <!-- Tab Buttons -->
            <div id="tabContainer" class="flex justify-center gap-2 mb-4">
                <button id="loginTab" class="w-1/2 px-2 py-1 rounded text-sm font-bold transition duration-300 tab-active" onclick="showLogin()">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login to GrowSEA
                </button>
                <button id="registerTab" class="w-1/2 px-2 py-1 rounded text-sm font-bold transition duration-300 tab-inactive" onclick="showRegister()">
                    <i class="fas fa-user-plus mr-2"></i>Register to GrowSEA
                </button>
            </div>

            <!-- Login Form -->
            <div id="loginFormContainer">
                <p class="text-white text-center font-bold text-2xl">Login with your Grow ID</p>
                <div id="errorDiv" class="hidden flex flex-col mt-2 text-xs text-red-700 font-bold px-[5px] bg-[#2b4d6d] rounded">
                    <a id="errorMessage"></a>
                </div>
                <form method="post" action="/player/growid/login/validate" accept-charset="UTF-8" id="loginForm" class="mt-3">
                    <div class="mb-1">
                        <input name="type" value="log" type="hidden" />
                        <input name="_token" value="__TOKEN__" type="hidden" />
                        <label for="loginGrowId" class="block text-white text-xs">GrowID</label>
                        <div class="flex items-center border-2 border-[#81d4fa] rounded bg-[#2b4d6d] px-1 py-1">
                            <i class="fas fa-user text-white mr-1 text-xs"></i>
                            <input type="text" name="growId" id="loginGrowId"
                                class="w-full bg-[#2b4d6d] text-white text-xs placeholder-white focus:outline-none"
                                placeholder="Enter Your GrowID">
                        </div>
                    </div>
                    <div class="mb-1">
                        <label for="loginPassword" class="block text-white text-xs">Password</label>
                        <div class="flex items-center border-2 border-[#81d4fa] rounded bg-[#2b4d6d] px-1 py-1">
                            <i class="fas fa-lock text-white mr-1 text-xs"></i>
                            <input type="password" name="password" id="loginPassword"
                                class="w-full bg-[#2b4d6d] text-white text-xs placeholder-white focus:outline-none"
                                placeholder="Enter Your Password">
                            <button type="button" id="toggleLogPassword" class="text-white ml-2 focus:outline-none text-xs">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-end items-center mt-3">
                        <button id="loginButton"
                            class="px-4 py-2 rounded bg-[#00b8ff] text-white text-sm hover:bg-[#06a4dd] transition duration-300 ease-in-out transform hover:scale-105">Login</button>
                    </div>
                </form>
            </div>

            <!-- Register Form -->
            <div id="registerFormContainer" class="form-hidden">
                <p class="text-white text-center font-bold text-2xl">Create your GrowID</p>
                <div id="regErrorDiv" class="hidden flex flex-col mt-2 text-xs text-red-700 font-bold px-[5px] bg-[#2b4d6d] rounded">
                    <a id="regErrorMessage"></a>
                </div>
                <div id="regSuccessDiv" class="hidden flex flex-col mt-2 text-xs text-green-400 font-bold px-[5px] bg-[#2b4d6d] rounded">
                    <a id="regSuccessMessage"></a>
                </div>
                <form method="post" action="/player/growid/register" accept-charset="UTF-8" id="registerForm" class="mt-3">
                    <div class="mb-1">
                        <input name="type" value="reg" type="hidden" />
                        <input name="_token" value="__TOKEN__" type="hidden" />
                        <label for="regGrowId" class="block text-white text-xs">GrowID</label>
                        <div class="flex items-center border-2 border-[#81d4fa] rounded bg-[#2b4d6d] px-1 py-1">
                            <i class="fas fa-user-plus text-white mr-1 text-xs"></i>
                            <input type="text" name="growId" id="regGrowId"
                                class="w-full bg-[#2b4d6d] text-white text-xs placeholder-white focus:outline-none"
                                placeholder="Choose a GrowID (3-20 chars)">
                        </div>
                    </div>
                    <div class="mb-1">
                        <label for="regPassword" class="block text-white text-xs">Password</label>
                        <div class="flex items-center border-2 border-[#81d4fa] rounded bg-[#2b4d6d] px-1 py-1">
                            <i class="fas fa-lock text-white mr-1 text-xs"></i>
                            <input type="password" name="password" id="regPassword"
                                class="w-full bg-[#2b4d6d] text-white text-xs placeholder-white focus:outline-none"
                                placeholder="Choose a password (min 6 chars)">
                            <button type="button" id="toggleRegPassword" class="text-white ml-2 focus:outline-none text-xs">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-end items-center mt-3">
                        <button type="button" id="registerButton"
                            class="px-4 py-2 rounded bg-[#00b8ff] text-white text-sm hover:bg-[#06a4dd] transition duration-300 ease-in-out transform hover:scale-105">Register</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Get mode from data attribute (set by server)
        let isRegisterMode = document.body.getAttribute('data-is-register') === 'true';

        function showLogin() {
            isRegisterMode = false;
            document.getElementById('loginFormContainer').classList.remove('form-hidden');
            document.getElementById('registerFormContainer').classList.add('form-hidden');
            document.getElementById('tabContainer').classList.remove('hidden');
            
            // Tab styling
            document.getElementById('loginTab').classList.add('tab-active');
            document.getElementById('loginTab').classList.remove('tab-inactive');
            document.getElementById('registerTab').classList.remove('tab-active');
            document.getElementById('registerTab').classList.add('tab-inactive');
            
            // Hide messages
            document.getElementById('regErrorDiv').classList.add('hidden');
            document.getElementById('regSuccessDiv').classList.add('hidden');
        }

        function showRegister() {
            isRegisterMode = true;
            document.getElementById('loginFormContainer').classList.add('form-hidden');
            document.getElementById('registerFormContainer').classList.remove('form-hidden');
            document.getElementById('tabContainer').classList.remove('hidden');
            
            // Tab styling
            document.getElementById('loginTab').classList.remove('tab-active');
            document.getElementById('loginTab').classList.add('tab-inactive');
            document.getElementById('registerTab').classList.add('tab-active');
            document.getElementById('registerTab').classList.remove('tab-inactive');
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Initialize to login view
            showLogin();
            
            if (localStorage.getItem('growId')) {
                document.getElementById('loginGrowId').value = localStorage.getItem('growId');
            }
        });

        // Login form handler
        document.getElementById('loginButton').addEventListener('click', function (event) {
            event.preventDefault();

            const loginForm = document.getElementById('loginForm');
            const uName = document.getElementById('loginGrowId').value;
            const uPass = document.getElementById('loginPassword').value;

            if (!uName || !uPass) {
                document.getElementById('errorDiv').classList.remove('hidden');
                document.getElementById('errorMessage').innerHTML = 'Username or Password is empty';
                return;
            } else if (uName.length < 4 || uPass.length < 4) {
                document.getElementById('errorDiv').classList.remove('hidden');
                document.getElementById('errorMessage').innerHTML = 'Username or Password must be at least 4 characters long';
                return;
            } else {
                loginForm.submit();
                localStorage.setItem('growId', document.getElementById('loginGrowId').value);
            }
        });

        // Toggle password visibility for login
        document.getElementById('toggleLogPassword').addEventListener('click', function () {
            const LpasswordField = document.getElementById('loginPassword');
            const LpasswordFieldType = LpasswordField.getAttribute('type');
            if (LpasswordFieldType === 'password') {
                LpasswordField.setAttribute('type', 'text');
                this.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                LpasswordField.setAttribute('type', 'password');
                this.innerHTML = '<i class="fas fa-eye"></i>';
            }
        });

        // Register form handler with AJAX
        document.getElementById('registerButton').addEventListener('click', async function (event) {
            event.preventDefault();

            const regGrowId = document.getElementById('regGrowId').value.trim();
            const regPassword = document.getElementById('regPassword').value;
            const errorDiv = document.getElementById('regErrorDiv');
            const successDiv = document.getElementById('regSuccessDiv');

            // Clear previous messages
            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');

            // Validation
            if (!regGrowId || !regPassword) {
                errorDiv.classList.remove('hidden');
                document.getElementById('regErrorMessage').innerHTML = 'GrowID and Password are required';
                return;
            }

            if (regGrowId.length < 3 || regGrowId.length > 20) {
                errorDiv.classList.remove('hidden');
                document.getElementById('regErrorMessage').innerHTML = 'GrowID must be between 3 and 20 characters';
                return;
            }

            if (regPassword.length < 6) {
                errorDiv.classList.remove('hidden');
                document.getElementById('regErrorMessage').innerHTML = 'Password must be at least 6 characters';
                return;
            }

            // Disable button during submission
            const registerButton = document.getElementById('registerButton');
            registerButton.disabled = true;
            registerButton.textContent = 'Creating...';

            try {
                const response = await fetch('/player/growid/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        growId: regGrowId, 
                        password: regPassword 
                    }),
                });

                const data = await response.json();

                if (data.status === 'success') {
                    successDiv.classList.remove('hidden');
                    document.getElementById('regSuccessMessage').innerHTML = 'Account created! Redirecting to login...';
                    
                    setTimeout(() => {
                        window.location.href = '/player/login/dashboard';
                    }, 1500);
                } else {
                    errorDiv.classList.remove('hidden');
                    document.getElementById('regErrorMessage').innerHTML = data.message || 'Registration failed. Please try again.';
                    registerButton.disabled = false;
                    registerButton.textContent = 'Register';
                }
            } catch (error) {
                errorDiv.classList.remove('hidden');
                document.getElementById('regErrorMessage').innerHTML = 'An error occurred. Please try again.';
                registerButton.disabled = false;
                registerButton.textContent = 'Register';
            }
        });

        // Toggle password visibility for register
        document.getElementById('toggleRegPassword').addEventListener('click', function () {
            const RegpasswordField = document.getElementById('regPassword');
            const RegpasswordFieldType = RegpasswordField.getAttribute('type');
            if (RegpasswordFieldType === 'password') {
                RegpasswordField.setAttribute('type', 'text');
                this.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                RegpasswordField.setAttribute('type', 'password');
                this.innerHTML = '<i class="fas fa-eye"></i>';
            }
        });
    </script>
</body>

</html>